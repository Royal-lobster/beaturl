<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BeatURL â€” Share Beats via URL</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0f;--surface:#12121a;--border:#1e1e2e;
  --text:#e0e0e0;--dim:#666;
  --kick:#ff3366;--snare:#ff9f43;--hihat:#00d2ff;
  --clap:#a855f7;--tom:#22c55e;--rim:#f472b6;
}
body{background:var(--bg);color:var(--text);font-family:'SF Mono',Monaco,'Cascadia Code',monospace;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px;user-select:none;-webkit-user-select:none}
h1{font-size:1.6rem;letter-spacing:4px;margin:10px 0 4px;background:linear-gradient(135deg,var(--kick),var(--hihat));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{color:var(--dim);font-size:.7rem;letter-spacing:2px;margin-bottom:20px}
.controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center;margin-bottom:20px}
button{background:var(--surface);border:1px solid var(--border);color:var(--text);padding:8px 18px;border-radius:6px;cursor:pointer;font-family:inherit;font-size:.8rem;transition:all .15s}
button:hover{border-color:#444;background:#1a1a2a}
button.active{background:var(--kick);border-color:var(--kick);color:#fff}
.bpm-wrap{display:flex;align-items:center;gap:8px}
.bpm-wrap label{font-size:.75rem;color:var(--dim)}
.bpm-wrap input[type=range]{width:100px;accent-color:var(--hihat)}
.bpm-val{font-size:.85rem;min-width:42px;text-align:center;color:var(--hihat)}
.sequencer{display:grid;gap:4px;margin-bottom:20px;width:100%;max-width:820px}
.track{display:contents}
.track-label{font-size:.65rem;letter-spacing:1px;text-transform:uppercase;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;white-space:nowrap}
.cell{
  aspect-ratio:1;border-radius:4px;cursor:pointer;
  background:var(--surface);border:1px solid var(--border);
  transition:background .1s,transform .08s,box-shadow .1s;
  min-width:0;position:relative;
}
.cell:hover{border-color:#333;transform:scale(1.08)}
.cell.on{border-color:transparent}
.cell.playing{box-shadow:0 0 12px rgba(255,255,255,.15)}
.share-wrap{display:flex;gap:8px;align-items:center;margin-bottom:16px}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:var(--hihat);color:#000;padding:8px 20px;border-radius:20px;font-size:.75rem;font-weight:600;opacity:0;transition:opacity .3s;pointer-events:none}
.toast.show{opacity:1}
.hint{color:var(--dim);font-size:.6rem;letter-spacing:1px;margin-top:8px}
.swing-wrap{display:flex;align-items:center;gap:8px}
.swing-wrap label{font-size:.75rem;color:var(--dim)}
.swing-wrap input[type=range]{width:60px;accent-color:var(--clap)}
.swing-val{font-size:.75rem;color:var(--clap);min-width:28px;text-align:center}

@media(max-width:600px){
  .sequencer{gap:3px}
  .track-label{font-size:.55rem;padding-right:4px}
  button{padding:6px 12px;font-size:.7rem}
  h1{font-size:1.2rem}
}
</style>
</head>
<body>

<h1>BEATURL</h1>
<p class="subtitle">ENCODE BEATS IN URLs</p>

<div class="controls">
  <button id="playBtn" onclick="togglePlay()">â–¶ PLAY</button>
  <button onclick="clearAll()">âœ• CLEAR</button>
  <div class="bpm-wrap">
    <label>BPM</label>
    <input type="range" id="bpmSlider" min="60" max="200" value="120" oninput="setBpm(this.value)">
    <span class="bpm-val" id="bpmVal">120</span>
  </div>
  <div class="swing-wrap">
    <label>SWING</label>
    <input type="range" id="swingSlider" min="0" max="80" value="0" oninput="setSwing(this.value)">
    <span class="swing-val" id="swingVal">0%</span>
  </div>
</div>

<div class="sequencer" id="seq"></div>

<div class="share-wrap">
  <button onclick="shareURL()">ðŸ”— SHARE BEAT</button>
  <button onclick="randomize()">ðŸŽ² RANDOM</button>
</div>

<p class="hint">SPACE = PLAY/STOP &middot; ENTIRE BEAT IS IN THE URL</p>

<div class="toast" id="toast">Link copied to clipboard!</div>

<script>
const TRACKS = [
  {name:'KICK',  color:'var(--kick)',  synth:'kick'},
  {name:'SNARE', color:'var(--snare)', synth:'snare'},
  {name:'HIHAT', color:'var(--hihat)', synth:'hihat'},
  {name:'CLAP',  color:'var(--clap)',  synth:'clap'},
  {name:'TOM',   color:'var(--tom)',   synth:'tom'},
  {name:'RIM',   color:'var(--rim)',   synth:'rim'},
];
const STEPS = 16;
const grid = TRACKS.map(()=>new Array(STEPS).fill(0));
let bpm = 120, swing = 0, playing = false, step = -1, timer = null;
let ctx = null;

function getCtx(){
  if(!ctx) ctx = new (window.AudioContext||window.webkitAudioContext)();
  if(ctx.state==='suspended') ctx.resume();
  return ctx;
}

// --- Drum Synths ---
function playKick(t){
  const c=getCtx(),o=c.createOscillator(),g=c.createGain();
  o.type='sine';o.frequency.setValueAtTime(160,t);o.frequency.exponentialRampToValueAtTime(30,t+.15);
  g.gain.setValueAtTime(.9,t);g.gain.exponentialRampToValueAtTime(.001,t+.3);
  o.connect(g);g.connect(c.destination);o.start(t);o.stop(t+.3);
}
function playSnare(t){
  const c=getCtx(),len=4096,buf=c.createBuffer(1,len,c.sampleRate),d=buf.getChannelData(0);
  for(let i=0;i<len;i++) d[i]=Math.random()*2-1;
  const n=c.createBufferSource(),nf=c.createBiquadFilter(),ng=c.createGain();
  n.buffer=buf;nf.type='highpass';nf.frequency.value=1000;
  ng.gain.setValueAtTime(.7,t);ng.gain.exponentialRampToValueAtTime(.001,t+.18);
  n.connect(nf);nf.connect(ng);ng.connect(c.destination);n.start(t);n.stop(t+.18);
  const o=c.createOscillator(),og=c.createGain();
  o.type='triangle';o.frequency.setValueAtTime(180,t);o.frequency.exponentialRampToValueAtTime(60,t+.08);
  og.gain.setValueAtTime(.4,t);og.gain.exponentialRampToValueAtTime(.001,t+.08);
  o.connect(og);og.connect(c.destination);o.start(t);o.stop(t+.08);
}
function playHihat(t){
  const c=getCtx(),len=2048,buf=c.createBuffer(1,len,c.sampleRate),d=buf.getChannelData(0);
  for(let i=0;i<len;i++) d[i]=Math.random()*2-1;
  const n=c.createBufferSource(),f=c.createBiquadFilter(),g=c.createGain();
  n.buffer=buf;f.type='highpass';f.frequency.value=7000;
  g.gain.setValueAtTime(.3,t);g.gain.exponentialRampToValueAtTime(.001,t+.06);
  n.connect(f);f.connect(g);g.connect(c.destination);n.start(t);n.stop(t+.06);
}
function playClap(t){
  const c=getCtx(),len=3000,buf=c.createBuffer(1,len,c.sampleRate),d=buf.getChannelData(0);
  for(let i=0;i<len;i++) d[i]=Math.random()*2-1;
  const n=c.createBufferSource(),f=c.createBiquadFilter(),g=c.createGain();
  n.buffer=buf;f.type='bandpass';f.frequency.value=1200;f.Q.value=.8;
  g.gain.setValueAtTime(0,t);
  for(let i=0;i<3;i++){g.gain.setValueAtTime(.6,t+i*.01);g.gain.setValueAtTime(.001,t+i*.01+.005);}
  g.gain.setValueAtTime(.6,t+.03);g.gain.exponentialRampToValueAtTime(.001,t+.15);
  n.connect(f);f.connect(g);g.connect(c.destination);n.start(t);n.stop(t+.15);
}
function playTom(t){
  const c=getCtx(),o=c.createOscillator(),g=c.createGain();
  o.type='sine';o.frequency.setValueAtTime(120,t);o.frequency.exponentialRampToValueAtTime(50,t+.2);
  g.gain.setValueAtTime(.6,t);g.gain.exponentialRampToValueAtTime(.001,t+.25);
  o.connect(g);g.connect(c.destination);o.start(t);o.stop(t+.25);
}
function playRim(t){
  const c=getCtx(),o=c.createOscillator(),g=c.createGain();
  o.type='square';o.frequency.setValueAtTime(800,t);
  g.gain.setValueAtTime(.3,t);g.gain.exponentialRampToValueAtTime(.001,t+.03);
  o.connect(g);g.connect(c.destination);o.start(t);o.stop(t+.03);
}
const synths={kick:playKick,snare:playSnare,hihat:playHihat,clap:playClap,tom:playTom,rim:playRim};

// --- Grid UI ---
function buildGrid(){
  const seq=document.getElementById('seq');
  seq.style.gridTemplateColumns=`50px repeat(${STEPS},1fr)`;
  seq.innerHTML='';
  TRACKS.forEach((tr,r)=>{
    const lbl=document.createElement('div');
    lbl.className='track-label';lbl.textContent=tr.name;
    lbl.style.color=tr.color;
    seq.appendChild(lbl);
    for(let c=0;c<STEPS;c++){
      const cell=document.createElement('div');
      cell.className='cell';
      cell.dataset.r=r;cell.dataset.c=c;
      cell.addEventListener('pointerdown',()=>toggleCell(r,c,cell));
      if(grid[r][c]) paintOn(cell,tr.color);
      seq.appendChild(cell);
    }
  });
}
function paintOn(el,color){el.classList.add('on');el.style.background=color;el.style.boxShadow=`0 0 8px ${color}40`;}
function paintOff(el){el.classList.remove('on');el.style.background='';el.style.boxShadow='';}
function toggleCell(r,c,el){
  grid[r][c]=grid[r][c]?0:1;
  grid[r][c]?paintOn(el,TRACKS[r].color):paintOff(el);
  encodeURL();
}
function getCell(r,c){return document.querySelector(`.cell[data-r="${r}"][data-c="${c}"]`);}

// --- Playback ---
function togglePlay(){playing?stopPlay():startPlay();}
function startPlay(){
  playing=true;step=-1;
  document.getElementById('playBtn').textContent='â¸ STOP';
  document.getElementById('playBtn').classList.add('active');
  tick();
}
function stopPlay(){
  playing=false;clearTimeout(timer);
  document.getElementById('playBtn').textContent='â–¶ PLAY';
  document.getElementById('playBtn').classList.remove('active');
  document.querySelectorAll('.cell.playing').forEach(c=>c.classList.remove('playing'));
  step=-1;
}
function tick(){
  if(!playing)return;
  document.querySelectorAll('.cell.playing').forEach(c=>c.classList.remove('playing'));
  step=(step+1)%STEPS;
  const t=getCtx().currentTime;
  TRACKS.forEach((tr,r)=>{
    const cell=getCell(r,step);
    if(cell)cell.classList.add('playing');
    if(grid[r][step]) synths[tr.synth](t);
  });
  const baseMs=60000/(bpm*4);
  const swingOffset=(step%2===1)? baseMs*(swing/100)*0.66 : 0;
  timer=setTimeout(tick, baseMs+swingOffset);
}

// --- Controls ---
function setBpm(v){bpm=+v;document.getElementById('bpmVal').textContent=v;encodeURL();}
function setSwing(v){swing=+v;document.getElementById('swingVal').textContent=v+'%';encodeURL();}
function clearAll(){grid.forEach(r=>r.fill(0));buildGrid();encodeURL();}
function randomize(){
  TRACKS.forEach((tr,r)=>{
    const density=r===0?.3:r===1?.2:r===2?.5:.15;
    for(let c=0;c<STEPS;c++) grid[r][c]=Math.random()<density?1:0;
  });
  buildGrid();encodeURL();
}

// --- URL State ---
function encodeURL(){
  const nums=grid.map(row=>{let n=0;row.forEach((v,i)=>{if(v)n|=(1<<i);});return n;});
  const data=[bpm,swing,...nums].join('.');
  history.replaceState(null,'','#'+data);
}
function decodeURL(){
  const h=location.hash.slice(1);
  if(!h)return;
  try{
    const parts=h.split('.').map(Number);
    if(parts.length<2+TRACKS.length)return;
    bpm=Math.max(60,Math.min(200,parts[0]||120));
    swing=Math.max(0,Math.min(80,parts[1]||0));
    document.getElementById('bpmSlider').value=bpm;
    document.getElementById('bpmVal').textContent=bpm;
    document.getElementById('swingSlider').value=swing;
    document.getElementById('swingVal').textContent=swing+'%';
    TRACKS.forEach((_,r)=>{
      const n=parts[2+r]||0;
      for(let c=0;c<STEPS;c++) grid[r][c]=(n>>c)&1;
    });
  }catch(e){}
}
function shareURL(){
  encodeURL();
  navigator.clipboard.writeText(location.href).then(()=>{
    const t=document.getElementById('toast');t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000);
  }).catch(()=>{prompt('Copy this URL:',location.href);});
}

// --- Keyboard ---
document.addEventListener('keydown',e=>{
  if(e.code==='Space'&&e.target===document.body){e.preventDefault();togglePlay();}
});

// --- Init ---
decodeURL();
buildGrid();
if(!location.hash) encodeURL();
</script>
</body>
</html>
